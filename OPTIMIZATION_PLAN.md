# 评价速度优化方案

## 问题分析

当前系统很慢的主要原因：
1. **串行处理**：一个学生评价完才处理下一个
2. **逐题调用API**：每道题单独调用一次API
3. **82个学生 × 8道题 = 656次API调用**

假设每次API调用需要3秒：
- 总时间：656 × 3秒 ≈ **33分钟**！

## 优化方案

### 方案1：批量评价（推荐）⭐
**原理**：将一个学生的所有题目一次性发给API评价

**优势**：
- API调用次数：82次（减少8倍）
- 预计时间：82 × 3秒 ≈ **4分钟**
- 评价更连贯，大模型可以看到学生整体表现

**实现**：修改prompt，一次发送所有代码

---

### 方案2：并发处理
**原理**：同时评价多个学生（使用多线程/异步）

**优势**：
- 可以并发10个请求
- 预计时间：656 ÷ 10 ÷ 3秒 ≈ **3.3分钟**

**风险**：
- API可能有速率限制
- 需要处理并发错误

---

### 方案3：组合优化（最优）⭐⭐⭐
**批量评价 + 适度并发**

**配置**：
- 每个学生的所有题目批量评价（1次API调用）
- 同时处理3-5个学生

**预计时间**：
- 82个学生 ÷ 3并发 × 3秒 ≈ **82秒 ≈ 1.5分钟**

---

## 推荐实现

我建议使用**方案1（批量评价）**，简单且有效！

```python
# 修改后的评价流程：
for student in students:
    # 收集该学生的所有代码
    all_codes = []
    for file in student['files']:
        all_codes.append({
            'file': file,
            'code': read_code(file)
        })

    # 一次性评价所有题目
    evaluation = evaluate_all_at_once(all_codes)

    # 解析评价结果
    parse_evaluation(evaluation)
```

是否要我实现这个优化？
