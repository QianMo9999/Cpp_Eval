# 快速参考指南

## 🚀 快速开始

### 基本使用（推荐）
```bash
python3 src/main.py data/第02周上机作业.zip --week 02
```

这条命令会：
- ✅ 自动解压ZIP文件
- ✅ 识别所有学生（包括未提交的）
- ✅ 自动处理 `.cpp.txt` 文件（重命名为 `.cpp`）
- ✅ 使用**批量评价模式**（每个学生一次API调用，速度快8倍）
- ✅ **实时生成PDF**：评价完一个学生立即生成PDF，无需等待
- ✅ 保存JSON结果文件

### 预期速度
- **82个学生 × 8道题** = 82次API调用
- **预计时间**: ~4分钟（旧模式需要33分钟）
- **速度提升**: 8倍

---

## 📋 命令行参数

### 基本参数
```bash
python3 src/main.py <ZIP文件路径> --week <周次>
```

### 可选参数
```bash
--provider deepseek     # 指定API提供商（openai/claude/deepseek/dashscope）
--output ./output       # 输出目录（默认: ./output）
--no-pdf               # 不生成PDF报告
--excel                # 同时生成Excel汇总
--no-json              # 不保存JSON结果
```

### 使用示例
```bash
# 使用DeepSeek API，生成PDF和Excel
python3 src/main.py data/第02周上机作业.zip --week 02 --provider deepseek --excel

# 只生成JSON，不生成PDF
python3 src/main.py data/第02周上机作业.zip --week 02 --no-pdf

# 指定输出目录
python3 src/main.py data/第02周上机作业.zip --week 02 --output ./week02_results
```

---

## 📁 文件结构要求

系统支持以下结构：

```
第02周上机作业/
└── 未分班/
    ├── 52********00+泮妍竹/
    │   ├── 52********00+泮妍竹.pdf  （会被忽略）
    │   └── 代码文件/
    │       ├── 第1关-求三位数-186949483/
    │       │   └── main.cpp.txt
    │       ├── 第2关-数字加密-186949484/
    │       │   └── main.cpp.txt
    │       └── ...（任意数量题目）
    └── 52********01+白若江/
        └── ...
```

**关键点**：
- ✅ 学生文件夹格式：`学号+姓名`
- ✅ `.cpp.txt` 文件会自动重命名为 `.cpp`
- ✅ 题目数量灵活（不限定为8道）
- ✅ 自动检测未提交作业的学生

---

## 📊 输出结果

### 默认输出
```
output/
├── 第02周_PDF/
│   ├── 52********00_泮妍竹_评价报告.pdf
│   ├── 52********01_白若江_评价报告.pdf
│   └── ...（每个学生一份）
└── 第02周_评价结果_20241029_142030.json
```

### PDF内容
每份PDF包含：
- 学生信息表格（姓名、学号、周次、总评分）
- 所有题目的详细评价
- 每题分数和总平均分

### JSON格式
```json
[
  {
    "student_name": "泮妍竹",
    "student_id": "52********00",
    "file_name": "main.cpp",
    "problem_name": "第1关-求三位数",
    "evaluation": "详细评价内容...",
    "score": 85,
    "timestamp": "2024-10-29 14:20:30",
    "status": "evaluated"
  },
  ...
]
```

---

## 🔧 环境配置

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 配置API密钥
创建 `.env` 文件：
```env
# 选择一个API提供商配置即可

# DeepSeek (推荐，性价比高)
DEEPSEEK_API_KEY=your_deepseek_api_key
DEEPSEEK_MODEL=deepseek-chat

# OpenAI
OPENAI_API_KEY=your_openai_api_key
OPENAI_MODEL=gpt-4

# Claude
ANTHROPIC_API_KEY=your_anthropic_api_key
ANTHROPIC_MODEL=claude-3-sonnet-20240229

# 阿里云DashScope
DASHSCOPE_API_KEY=your_dashscope_api_key
DASHSCOPE_MODEL=qwen-plus
```

---

## 💡 批量评价模式说明

### 工作原理
**旧模式**（已废弃）：
```
学生A-题目1 → API调用1 → 评价
学生A-题目2 → API调用2 → 评价
...
学生A-题目8 → API调用8 → 评价
```
需要 **82学生 × 8题 = 656次API调用**

**新模式**（当前）：
```
学生A-所有8道题 → API调用1 → 一次性获得所有评价
```
只需 **82次API调用**

### 优势
- ✅ API调用减少8倍
- ✅ 评价速度提升8倍
- ✅ 评价更连贯（大模型能看到学生整体表现）
- ✅ 成本更低
- ✅ 自动适应不同题目数（5题、8题、10题都可以）

详见 `BATCH_MODE.md` 了解更多。

---

## 📈 运行输出示例

```
============================================================
C++作业自动评价系统
============================================================
ZIP文件: data/第02周上机作业.zip
作业周次: 第02周
输出目录: ./output
============================================================

[步骤 1/4] 解压ZIP文件...
✓ ZIP文件解压成功: /var/folders/.../第02周上机作业

[步骤 2/4] 扫描学生和作业文件...
✓ 找到 82 个学生文件夹
✓ 自动处理了 624 个 .cpp.txt 文件

⚠ 以下学生未提交作业:
   - 52********03 张三
   - 52********04 李四

[步骤 3/4] 开始批量评价 (共78个学生)...
💡 提示：现在使用批量评价模式，每个学生的所有题目一次性评价，速度更快！
------------------------------------------------------------

[1/78] 评价学生: 52********00 泮妍竹 (8道题)
   正在评价 8 道题...
✓ 评价完成 (平均分: 85.3/100，8/8题)

[2/78] 评价学生: 52********01 白若江 (8道题)
   正在评价 8 道题...
✓ 评价完成 (平均分: 90.5/100，8/8题)

...

[步骤 4/4] 保存评价结果...
------------------------------------------------------------

生成PDF报告...
✓ 已生成 78 份PDF报告
✓ JSON结果已保存: output/第02周_评价结果_20241029_142030.json

============================================================
评价完成!
============================================================
学生总数: 82 人
  - 已提交并评价: 78 人
  - 未提交作业: 4 人

分数统计（已提交作业）:
  - 平均分: 85.3
  - 最高分: 98
  - 最低分: 72
============================================================
```

---

## ⚠️ 常见问题

### Q1: 如何修改评价标准？
编辑 `config/prompts.py` 文件，修改 `WEEK_BATCH_PROMPTS` 字典中的提示词。

### Q2: 支持哪些API提供商？
- OpenAI GPT（gpt-4, gpt-3.5-turbo）
- Anthropic Claude（claude-3-sonnet, claude-3-opus）
- DeepSeek（deepseek-chat）- 推荐，性价比高
- 阿里云DashScope（qwen-plus, qwen-turbo）

### Q3: 如何处理评价失败的学生？
查看 JSON 结果文件，找到 `"status": "failed"` 的记录，可以单独重新评价。

### Q4: 能否导出Excel格式？
可以，使用 `--excel` 参数：
```bash
python3 src/main.py data/作业.zip --week 02 --excel
```

### Q5: PDF中文显示异常？
系统会自动检测系统字体：
- macOS: `/System/Library/Fonts/STHeiti Light.ttc`
- Windows: `C:/Windows/Fonts/simsun.ttc`

如果仍有问题，请确保系统已安装中文字体。

---

## 📚 相关文档

- `README.md` - 完整使用文档
- `BATCH_MODE.md` - 批量评价模式详解
- `DEEPSEEK_GUIDE.md` - DeepSeek配置指南
- `TROUBLESHOOTING.md` - 故障排除指南
- `UPDATE_SUMMARY.md` - 功能更新总结

---

## 🎯 技术特点

1. **智能文件处理**
   - 自动重命名 `.cpp.txt` → `.cpp`
   - 智能提取学号和姓名
   - 递归扫描多层嵌套目录

2. **高效评价**
   - 批量评价模式（8倍速度提升）
   - 支持多个API提供商
   - 自动适应不同题目数量

3. **专业输出**
   - PDF报告（每个学生一份）
   - 中文字体支持
   - 详细的统计信息

4. **完善的错误处理**
   - 检测未提交作业
   - 记录评价失败信息
   - 详细的进度显示

---

**版本**: v1.3.0 - 批量评价优化版
**更新时间**: 2024-10-29
